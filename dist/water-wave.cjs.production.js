"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=require("react");var t=require("raf-dom");function r(e){return e&&typeof e==="object"&&"default"in e?e:{default:e}}var a=r(e);function n(e){if(Array.isArray(e))return e}var o=n;function i(e,t){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(e)))return;var r=[];var a=true;var n=false;var o=undefined;try{for(var i=e[Symbol.iterator](),s;!(a=(s=i.next()).done);a=true){r.push(s.value);if(t&&r.length===t)break}}catch(e){n=true;o=e}finally{try{if(!a&&i["return"]!=null)i["return"]()}finally{if(n)throw o}}return r}var s=i;function u(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,a=new Array(t);r<t;r++){a[r]=e[r]}return a}var l=u;function c(e,t){if(!e)return;if(typeof e==="string")return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return l(e,t)}var f=c;function v(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var p=v;function h(e,t){return o(e)||s(e,t)||f(e,t)||p()}var d=h;function m(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var y=m;function b(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}function g(e,t,r){if(t)b(e.prototype,t);if(r)b(e,r);return e}var w=g;function M(e,t){return t={exports:{}},e(t,t.exports),t.exports}var S=M((function(e){function t(r,a){e.exports=t=Object.setPrototypeOf||function e(t,r){t.__proto__=r;return t};return t(r,a)}e.exports=t}));function k(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});if(t)S(e,t)}var P=k;var C=M((function(e){function t(r){e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function e(t){return t.__proto__||Object.getPrototypeOf(t)};return t(r)}e.exports=t}));function T(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}var x=T;var E=M((function(e){function t(r){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){e.exports=t=function e(t){return typeof t}}else{e.exports=t=function e(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}}return t(r)}e.exports=t}));function O(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}var j=O;function I(e,t){if(t&&(E(t)==="object"||typeof t==="function")){return t}return j(e)}var N=I;function A(e){var t=x();return function r(){var a=C(e),n;if(t){var o=C(this).constructor;n=Reflect.construct(a,arguments,o)}else{n=a.apply(this,arguments)}return N(this,n)}}var _=A;var R=typeof window==="undefined"?global:window;var X="onpointerdown"in R?{pointerdown:0,pointerup:2,pointercancel:3,pointerleave:4,blur:5,waterwave:6}:{touchstart:0,mousedown:0,touchend:2,mouseup:2,touchcancel:3,mouseleave:4,blur:5,waterwave:6};var D=function e(t){return X[t.toLowerCase()]};var L=function e(t){var r=t.toLowerCase().match(/(touch|pointer|mouse)/i);return r&&r[0]};var Y=function e(t){var r=L(t.type);if(r==="touch"){var a=t.changedTouches.item(0),n=a.clientX,o=a.clientY,i=a.pageX,s=a.pageY;return Object.assign(t,{clientX:n,clientY:o},"pageX"in t?{}:{pageX:i,pageY:s})}return t};var W=function e(t,r,a,n){return-a*(t/=n)*(t-2)+r};var q=function(){function e(){y(this,e);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++){r[a]=arguments[a]}this.rippleData=r}w(e,[{key:"pressUp",value:function e(){this.rippleData.splice(-2,1,false)}},{key:"render",value:function e(){var t=Date.now();var r=d(this.rippleData,8),a=r[0],n=r[1],o=r[2],i=r[3],s=r[4],u=r[5],l=r[6],c=r[7];var f=c.effect,v=c.duration,p=c.alpha,h=c.color;var m=t-u;var y=Math.max(n,i-n);var b=Math.max(o,s-o);var g=typeof c.radius==="number"?c.radius:Math.sqrt(Math.pow(y,2)+Math.pow(b,2));var w=Math.max(Math.min(1,W(m,0,1,v)),0);var M=l?p:Math.min(p,p-(w-.7)*p/.3);a.globalAlpha=M;a.beginPath();if(f==="wave"){var S=m/3*Math.PI/180;var k=Math.max(s/2,s-o)*(1-w);var P=Math.sin(S)*k;var C=Math.cos(S)*k;var T=(1-w)*o;a.moveTo((n-y)*w,T+P);a.bezierCurveTo(n,T+P-k,n,T+C-k,i+(n+y-i)*w,T+C);a.lineTo(i,s);a.lineTo(0,s)}else if(f==="petal"){var x=typeof c.radius==="number"?c.radius:w*Math.max(i,s)/2;var E=x*.5;if(!this.petalNumber){this.petalNumber=parseInt(Math.random()*17)+4}var O=Math.PI*2/this.petalNumber;var j=Math.sin(O)*E;var I=-Math.cos(O)*E;var N=x/Math.cos(O/2)*1.3;var A=Math.sin(O)*N;var _=-Math.cos(O)*N;a.save();a.translate(n,o);a.rotate(Math.PI*w);a.moveTo(0,I);for(var R=0;R<this.petalNumber;R++){a.bezierCurveTo(0,-N,A,_,j,I);a.rotate(O)}a.restore()}else if(f==="starLight"){var X=w*Math.min(i,s,g);a.arc(n,o,X,0,2*Math.PI,false);if(!this.stars){var D=parseInt(Math.random()*10)+10;this.stars=[];for(var L=0;L<D;L++){this.stars[L]=Math.random()*g}}var Y=Math.PI*2/this.stars.length;a.save();a.translate(n,o);a.moveTo(0,-X);this.stars.forEach((function(e,t){a.rotate(Y/2);a.lineTo(0,-X-w*e);a.rotate(Y/2);a.lineTo(0,-X)}));a.restore()}else if(f==="helix"){var q=2;var F=Math.min(10,parseInt(g/q));var G=w*360*(F+1);var U=g/F;a.save();a.translate(n,o);a.rotate(m*Math.PI/180);a.moveTo(0,0);for(var z=0;z<G;z++){var H=z/360*U;a.lineTo(Math.cos(z*Math.PI/180)*H,Math.sin(z*Math.PI/180)*H)}a.restore();a.lineWidth=U*w;a.lineCap="round";a.strokeStyle=h;a.stroke();return m<v}else{a.arc(n,o,w*g,0,2*Math.PI,false)}a.fillStyle=h;a.closePath();a.fill();return m<v}}]);return e}();var F="water-wave-canvas-duration";var G=typeof window==="undefined"?global:window;var U=function(e){P(n,e);var r=_(n);function n(){var e;y(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++){o[i]=arguments[i]}e=r.call.apply(r,[this].concat(o));e.ripples=[];e.canvas=null;e.refCanvasCallback=function(t){return e.canvas=t};e.createWave=function(r){var a=e.canvas;var n=a.parentNode;var o=typeof e.props.disabled==="boolean"?e.props.disabled:n.disabled;if(!o){var i=G.devicePixelRatio||1;var s=n.getBoundingClientRect(),u=s.top,l=s.left,c=s.width,f=s.height;var v=r.clientX,p=r.clientY;var h=v-l;var m=p-u;var y=a.getContext("2d");var b=e.props,g=b.press,w=b.stopPropagation;var M=e.getOrigin(c,f),S=d(M,2),k=S[0],P=S[1];if(!e.dispatchEvent(w)){return}a.width=c*i;a.height=f*i;y.scale(i,i);a.classList.add(F);var C=Date.now();e.ripples.push(new q(y,isNaN(k)?h:k,isNaN(P)?m:P,c,f,C,true,e.props));var T=function r(){t.cancelAnimationFrame(e.timer);y.clearRect(0,0,c,f);e.ripples=e.ripples.filter((function(e){return e.render()}));if(e.ripples.length){e.timer=t.requestAnimationFrame(r)}else if(g==="down"&&e.startState){e.clearShadow=function(){delete e.clearShadow;a.classList.remove(F)}}else{a.classList.remove(F)}};T()}};return e}w(n,[{key:"componentDidMount",value:function e(){var t=this;var r=this.canvas.parentNode;var a=G.getComputedStyle(r,null),n=a.position;if(n==="static"){r.style.position="relative"}r.style.webkitTapHighlightColor="rgba(0,0,0,0)";Object.keys(X).forEach((function(e){r.addEventListener(e,t,false)}))}},{key:"componentWillUnmount",value:function e(){var r=this;var a=this.canvas.parentNode;t.cancelAnimationFrame(this.timer);clearTimeout(this.clearTimer);a.style.webkitTapHighlightColor=null;Object.keys(X).forEach((function(e){a.removeEventListener(e,r,false)}))}},{key:"handleEvent",value:function e(t){var r=this;var a=D(t.type);var n=L(t.type);var o=this.props.press;switch(a){case 0:if(!this.eventGroup){this.eventGroup=n}case 2:case 3:case 4:case 5:if(this.eventGroup===n||a>3){var i=Y(t);var s=i.pageX,u=i.pageY;clearTimeout(this.clearTimer);if(a===0){if(!this.startState){this.startState={pageX:s,pageY:u}}if(o==="down"){setTimeout((function(){return r.startState&&r.createWave(i)}),0)}}else{if(o==="up"&&a===2){if(this.startState&&Math.abs(s-this.startState.pageX)<10&&Math.abs(u-this.startState.pageY)<10){this.createWave(i)}}if(o==="down"){if(this.clearShadow){this.clearShadow()}}this.clearEvent()}}break;case 6:if(t.target!==this.canvas.parentNode&&(t.detail.shouldCancel||t.defaultPrevented)){this.clearEvent()}break}}},{key:"clearEvent",value:function e(){var t=this;if(this.ripples.length){this.ripples.slice(-1)[0].pressUp()}delete this.startState;this.clearTimer=setTimeout((function(){delete t.eventGroup}),500)}},{key:"dispatchEvent",value:function e(){var t;var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var a;if(typeof G.CustomEvent==="function"){a=new CustomEvent("waterwave",{bubbles:true,cancelable:true,detail:{shouldCancel:r}})}else{a=document.createEvent("CustomEvent");a.initCustomEvent("waterwave",true,true,{shouldCancel:r})}return(t=this.canvas.parentNode)===null||t===void 0?void 0:t.dispatchEvent(a)}},{key:"getOrigin",value:function e(t,r){var a=this.props.origin.split(/\s+/);var n=this.getPoint(a[0],t);var o=this.getPoint(a[1],r);return[n,o]}},{key:"getPoint",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"auto";var r=arguments.length>1?arguments[1]:undefined;var a=t;if(/^\d+%?$/.test(t)===false){switch(t){case"top":case"left":a="0";break;case"right":case"bottom":a="100%";break;case"center":a="50%";break}}return parseFloat(a)*(a.substr(-1)==="%"?r/100:1)}},{key:"render",value:function e(){return a["default"].createElement("canvas",{ref:this.refCanvasCallback,className:"water-wave-canvas"})}}]);return n}(e.Component);U.defaultProps={duration:550,color:"#fff",origin:"auto",radius:"auto",alpha:.3,press:"up",effect:"ripple"};exports.default=U;
