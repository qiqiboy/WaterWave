import e,{Component as t}from"react";import{cancelAnimationFrame as r,requestAnimationFrame as a}from"raf-dom";function n(e){if(Array.isArray(e))return e}function i(e,t){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(e)))return;var r=[];var a=true;var n=false;var i=undefined;try{for(var o=e[Symbol.iterator](),s;!(a=(s=o.next()).done);a=true){r.push(s.value);if(t&&r.length===t)break}}catch(e){n=true;i=e}finally{try{if(!a&&o["return"]!=null)o["return"]()}finally{if(n)throw i}}return r}function o(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,a=new Array(t);r<t;r++){a[r]=e[r]}return a}function s(e,t){if(!e)return;if(typeof e==="string")return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(e,t)}function u(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(e,t){return n(e)||i(e,t)||s(e,t)||u()}function c(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function f(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}function v(e,t,r){if(t)f(e.prototype,t);if(r)f(e,r);return e}function p(e,t){p=Object.setPrototypeOf||function e(t,r){t.__proto__=r;return t};return p(e,t)}function h(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});if(t)p(e,t)}function d(e){d=Object.setPrototypeOf?Object.getPrototypeOf:function e(t){return t.__proto__||Object.getPrototypeOf(t)};return d(e)}function y(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function m(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){m=function e(t){return typeof t}}else{m=function e(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}}return m(e)}function b(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function g(e,t){if(t&&(m(t)==="object"||typeof t==="function")){return t}return b(e)}function w(e){var t=y();return function r(){var a=d(e),n;if(t){var i=d(this).constructor;n=Reflect.construct(a,arguments,i)}else{n=a.apply(this,arguments)}return g(this,n)}}var M=typeof window==="undefined"?global:window;var S="onpointerdown"in M?{pointerdown:0,pointerup:2,pointercancel:3,pointerleave:4,blur:5,waterwave:6}:{touchstart:0,mousedown:0,touchend:2,mouseup:2,touchcancel:3,mouseleave:4,blur:5,waterwave:6};var P=function e(t){return S[t.toLowerCase()]};var T=function e(t){var r=t.toLowerCase().match(/(touch|pointer|mouse)/i);return r&&r[0]};var k=function e(t){var r=T(t.type);if(r==="touch"){var a=t.changedTouches.item(0),n=a.clientX,i=a.clientY,o=a.pageX,s=a.pageY;return Object.assign(t,{clientX:n,clientY:i},"pageX"in t?{}:{pageX:o,pageY:s})}return t};var E=function e(t,r,a,n){return-a*(t/=n)*(t-2)+r};var C=function(){function e(){c(this,e);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++){r[a]=arguments[a]}this.rippleData=r}v(e,[{key:"pressUp",value:function e(){this.rippleData.splice(-2,1,false)}},{key:"render",value:function e(){var t=Date.now();var r=l(this.rippleData,8),a=r[0],n=r[1],i=r[2],o=r[3],s=r[4],u=r[5],c=r[6],f=r[7];var v=f.effect,p=f.duration,h=f.alpha,d=f.color;var y=t-u;var m=Math.max(n,o-n);var b=Math.max(i,s-i);var g=typeof f.radius==="number"?f.radius:Math.sqrt(Math.pow(m,2)+Math.pow(b,2));var w=Math.max(Math.min(1,E(y,0,1,p)),0);var M=c?h:Math.min(h,h-(w-.7)*h/.3);a.globalAlpha=M;a.beginPath();if(v==="wave"){var S=y/3*Math.PI/180;var P=Math.max(s/2,s-i)*(1-w);var T=Math.sin(S)*P;var k=Math.cos(S)*P;var C=(1-w)*i;a.moveTo((n-m)*w,C+T);a.bezierCurveTo(n,C+T-P,n,C+k-P,o+(n+m-o)*w,C+k);a.lineTo(o,s);a.lineTo(0,s)}else if(v==="petal"){var O=typeof f.radius==="number"?f.radius:w*Math.max(o,s)/2;var I=O*.5;if(!this.petalNumber){this.petalNumber=parseInt(Math.random()*17)+4}var j=Math.PI*2/this.petalNumber;var N=Math.sin(j)*I;var x=-Math.cos(j)*I;var A=O/Math.cos(j/2)*1.3;var R=Math.sin(j)*A;var X=-Math.cos(j)*A;a.save();a.translate(n,i);a.rotate(Math.PI*w);a.moveTo(0,x);for(var D=0;D<this.petalNumber;D++){a.bezierCurveTo(0,-A,R,X,N,x);a.rotate(j)}a.restore()}else if(v==="starLight"){var L=w*Math.min(o,s,g);a.arc(n,i,L,0,2*Math.PI,false);if(!this.stars){var Y=parseInt(Math.random()*10)+10;this.stars=[];for(var _=0;_<Y;_++){this.stars[_]=Math.random()*g}}var W=Math.PI*2/this.stars.length;a.save();a.translate(n,i);a.moveTo(0,-L);this.stars.forEach((function(e,t){a.rotate(W/2);a.lineTo(0,-L-w*e);a.rotate(W/2);a.lineTo(0,-L)}));a.restore()}else if(v==="helix"){var G=2;var U=Math.min(10,parseInt(g/G));var z=w*360*(U+1);var H=g/U;a.save();a.translate(n,i);a.rotate(y*Math.PI/180);a.moveTo(0,0);for(var $=0;$<z;$++){var q=$/360*H;a.lineTo(Math.cos($*Math.PI/180)*q,Math.sin($*Math.PI/180)*q)}a.restore();a.lineWidth=H*w;a.lineCap="round";a.strokeStyle=d;a.stroke();return y<p}else{a.arc(n,i,w*g,0,2*Math.PI,false)}a.fillStyle=d;a.closePath();a.fill();return y<p}}]);return e}();var O="water-wave-canvas-duration";var I=typeof window==="undefined"?global:window;var j=function(t){h(i,t);var n=w(i);function i(){var e;c(this,i);for(var t=arguments.length,o=new Array(t),s=0;s<t;s++){o[s]=arguments[s]}e=n.call.apply(n,[this].concat(o));e.ripples=[];e.createWave=function(t){var n=e.refs.canvas;var i=n.parentNode;var o=typeof e.props.disabled==="boolean"?e.props.disabled:i.disabled;if(!o){var s=I.devicePixelRatio||1;var u=i.getBoundingClientRect(),c=u.top,f=u.left,v=u.width,p=u.height;var h=t.clientX,d=t.clientY;var y=h-f;var m=d-c;var b=e.refs.canvas;var g=b.getContext("2d");var w=e.props,M=w.press,S=w.stopPropagation;var P=e.getOrigin(v,p),T=l(P,2),k=T[0],E=T[1];if(!e.dispatchEvent(S)){return}b.width=v*s;b.height=p*s;g.scale(s,s);b.classList.add(O);var j=Date.now();e.ripples.push(new C(g,isNaN(k)?y:k,isNaN(E)?m:E,v,p,j,true,e.props));var N=function t(){r(e.timer);g.clearRect(0,0,v,p);e.ripples=e.ripples.filter((function(e){return e.render()}));if(e.ripples.length){e.timer=a(t)}else if(M==="down"&&e.startState){e.clearShadow=function(){delete e.clearShadow;b.classList.remove(O)}}else{b.classList.remove(O)}};N()}};return e}v(i,[{key:"componentDidMount",value:function e(){var t=this;var r=this.refs.canvas.parentNode;var a=I.getComputedStyle(r,null),n=a.position;if(n==="static"){r.style.position="relative"}r.style.webkitTapHighlightColor="rgba(0,0,0,0)";Object.keys(S).forEach((function(e){r.addEventListener(e,t,false)}))}},{key:"componentWillUnmount",value:function e(){var t=this;var a=this.refs.canvas.parentNode;r(this.timer);clearTimeout(this.clearTimer);a.style.webkitTapHighlightColor=null;Object.keys(S).forEach((function(e){a.removeEventListener(e,t,false)}))}},{key:"handleEvent",value:function e(t){var r=this;var a=P(t.type);var n=T(t.type);var i=this.props.press;switch(a){case 0:if(!this.eventGroup){this.eventGroup=n}case 2:case 3:case 4:case 5:if(this.eventGroup===n||a>3){var o=k(t);var s=o.pageX,u=o.pageY;clearTimeout(this.clearTimer);if(a===0){if(!this.startState){this.startState={pageX:s,pageY:u}}if(i==="down"){setTimeout((function(){return r.startState&&r.createWave(o)}),0)}}else{if(i==="up"&&a===2){if(this.startState&&Math.abs(s-this.startState.pageX)<10&&Math.abs(u-this.startState.pageY)<10){this.createWave(o)}}if(i==="down"){if(this.clearShadow){this.clearShadow()}}this.clearEvent()}}break;case 6:if(t.target!==this.refs.canvas.parentNode&&(t.detail.shouldCancel||t.defaultPrevented)){this.clearEvent()}break}}},{key:"clearEvent",value:function e(){var t=this;if(this.ripples.length){this.ripples.slice(-1)[0].pressUp()}delete this.startState;this.clearTimer=setTimeout((function(){delete t.eventGroup}),500)}},{key:"dispatchEvent",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var r;if(typeof I.CustomEvent==="function"){r=new CustomEvent("waterwave",{bubbles:true,cancelable:true,detail:{shouldCancel:t}})}else{r=document.createEvent("CustomEvent");r.initCustomEvent("waterwave",true,true,{shouldCancel:t})}return this.refs.canvas.parentNode.dispatchEvent(r)}},{key:"getOrigin",value:function e(t,r){var a=this.props.origin.split(/\s+/);var n=this.getPoint(a[0],t);var i=this.getPoint(a[1],r);return[n,i]}},{key:"getPoint",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"auto";var r=arguments.length>1?arguments[1]:undefined;var a=t;if(/^\d+%?$/.test(t)===false){switch(t){case"top":case"left":a="0";break;case"right":case"bottom":a="100%";break;case"center":a="50%";break}}return parseFloat(a)*(a.substr(-1)==="%"?r/100:1)}},{key:"render",value:function t(){return e.createElement("canvas",{ref:"canvas",className:"water-wave-canvas"})}}]);return i}(t);j.defaultProps={duration:550,color:"#fff",origin:"auto",radius:"auto",alpha:.3,press:"up",effect:"ripple"};export default j;
